# name: test/sql/uuid_functions.test
# description: Test UUID generation functions
# group: [stps]

require stps

# stps_uuid - generates random UUID v4
# We can only verify format, not exact value
query I
SELECT length(stps_uuid()) = 36;
----
true

query I
SELECT stps_uuid() LIKE '________-____-4___-____-____________';
----
true

# stps_uuid_from_string - deterministic UUID v5 from string
# Same input should always produce same output
query T
SELECT stps_uuid_from_string('test');
----
f9e6e6ef-197c-5b25-9f2c-d9c79423ab75

query T
SELECT stps_uuid_from_string('hello');
----
a430d846-80aa-5d0b-b695-136cbd22ce9b

query I
SELECT stps_uuid_from_string('test') = stps_uuid_from_string('test');
----
true

query I
SELECT stps_uuid_from_string('a') != stps_uuid_from_string('b');
----
true

query T
SELECT stps_uuid_from_string('');
----
cbf29ce4-8422-5325-9e37-79b97f4a7c15

# stps_get_guid - deterministic UUID from multiple columns
query T
SELECT stps_get_guid('col1');
----
0bd0b391-1963-54e0-997a-677942646d30

query T
SELECT stps_get_guid('col1', 'col2');
----
c8ee2fd9-e115-5da0-9d26-b6c622bb1bd0

query T
SELECT stps_get_guid('col1', 'col2', 'col3');
----
5ffd981c-560e-5a93-8a98-887a0d439223

# Same inputs should produce same GUID
query I
SELECT stps_get_guid('a', 'b') = stps_get_guid('a', 'b');
----
true

# stps_guid_to_path - convert GUID to 4-level folder path
# f9=249, e6=230, e6=230, ef=239
query T
SELECT stps_guid_to_path('f9e6e6ef-197c-5b25-9f2c-d9c79423ab75');
----
249/230/230/239

# Works without hyphens
query T
SELECT stps_guid_to_path('f9e6e6ef197c5b259f2cd9c79423ab75');
----
249/230/230/239

# Case insensitive - uppercase
query T
SELECT stps_guid_to_path('F9E6E6EF-197C-5B25-9F2C-D9C79423AB75');
----
249/230/230/239

# Different GUID produces different path
# a4=164, 30=48, d8=216, 46=70
query T
SELECT stps_guid_to_path('a430d846-80aa-5d0b-b695-136cbd22ce9b');
----
164/48/216/70

# Deterministic - same GUID always gives same path
query I
SELECT stps_guid_to_path('f9e6e6ef-197c-5b25-9f2c-d9c79423ab75') = stps_guid_to_path('f9e6e6ef-197c-5b25-9f2c-d9c79423ab75');
----
true

# Edge case: 00000000 gives 0/0/0/0
query T
SELECT stps_guid_to_path('00000000-0000-0000-0000-000000000000');
----
0/0/0/0

# Edge case: ffffffff gives 255/255/255/255
query T
SELECT stps_guid_to_path('ffffffff-ffff-ffff-ffff-ffffffffffff');
----
255/255/255/255

# Invalid GUID - too short
query T
SELECT stps_guid_to_path('abc');
----
ERROR: Invalid GUID

# Invalid GUID - invalid characters
query T
SELECT stps_guid_to_path('ghijklmn-opqr-stuv-wxyz-123456789012');
----
ERROR: Invalid GUID
